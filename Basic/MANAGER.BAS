10000 ' COCO 3 MEMORY MANAGER
10010 '
10020 IF ZZ=0 THEN ZZ=1 ELSE GOTO 10150
10030 '
10040 ' INITIALIZATION
10050 DATA BD,B3,ED,1A,50,B7,FF,A0,B7,FF,A8,F7,FF,A1,F7,FF,A9,8E,00,00
10060 DATA A6,84,A7,89,20,00,30,01,8C,20,00,26,F3,17,81,73,1C,AF,39
10070 FOR I=&H5F00 TO &H5F00+38
10080 READ A$: POKE I,VAL("&H"+A$)
10090 NEXT I
10100 DEFUSR9=&H5F00
10110 ZM$=STRING$(48*3," ")
10120 RETURN
10130 '
10140 ' COMMAND DECODE
10150 ZE=0
10160 ZA=INSTR("DELSTRGETREAWRI",ZF$)
10170 IF ZA=0 THEN ZE=1: GOTO 10940
10180 ZA=(ZA+2)/3
10190 ON ZA GOTO 10210,10290,10470,10590,10780
10200 '
10210 ' DEL(ETE) FUNCTION - DELETES ENTRY FROM MAP
10220 GOSUB 10910
10230 IF ZC$="999" THEN ZM$=STRING$(48*3," "): GOTO 10940
10240 ZA=INSTR(ZM$,ZC$)
10250 IF ZA=0 THEN ZE=1: GOTO 10940
10260 IF VAL(ZC$)<100 THEN MID$(ZM$,ZA,12)="            " ELSE MID$(ZM$,ZA,3)="   "
10270 GOTO 10940
10280 '
10290 ' ST(O)R(E) FUNCTION - STORES BLOCK TO MEMORY
10300 GOSUB 10910
10310 ZA=INSTR(ZM$,ZC$)
10320 IF ZA<>0 THEN ZE=1: GOTO 10940
10330 IF VAL(ZC$)<100 THEN ZB$="            " ELSE ZB$="   "
10340 ZA=INSTR(ZM$,ZB$)
10350 IF ZA=0 THEN ZE=1: GOTO 10940
10360 IF VAL(ZC$)<100 THEN ZC$=ZC$+ZC$+ZC$+ZC$
10370 MID$(ZM$,ZA,LEN(ZC$))=ZC$
10380 ZB=(ZA-1)/3
10390 ZC$=LEFT$(ZC$,3)
10400 IF VAL(ZC$)<100 THEN ZD=48 ELSE IF VAL(ZC$)<200 THEN ZD=54 ELSE IF VAL(ZC$)<300 THEN ZD=52 ELSE ZE=1: GOTO 10940
10410 IF VAL(ZC$)<100 THEN ZF=3 ELSE ZF=0
10420 FOR ZI=0 TO ZF
10430 A=USR9((ZD+ZI)*256+ZB+ZI)
10440 NEXT
10450 GOTO 10940
10460 '
10470 ' GET FUNCTION - GETS BLOCK FROM MEMORY
10480 GOSUB 10910
10490 ZA=INSTR(ZM$,ZC$)
10500 IF ZA=0 THEN ZE=1: GOTO 10940
10510 ZB=(ZA-1)/3
10520 IF VAL(ZC$)<100 THEN ZD=48 ELSE IF VAL(ZC$)<200 THEN ZD=54 ELSE IF VAL(ZC$)<300 THEN ZD=52 ELSE ZE=1: GOTO 10940
10530 IF VAL(ZC$)<100 THEN ZF=3 ELSE ZF=0
10540 FOR ZI=0 TO ZF
10550 A=USR9((ZB+ZI)*256+ZD+ZI)
10560 NEXT
10570 GOTO 10940
10580 '
10590 ' REA(D) FUNCTION - READS BLOCK FROM DISK FILE
10600 GOSUB 10910
10610 ZA=INSTR(ZM$,ZC$)
10620 IF ZA<>0 THEN ^E=1: GOTO 10940
10630 IF VAL(ZC$)<100 THEN ZB$="            " ELSE ZB$="   "
10640 ZA=INSTR(ZM$,ZB$)
10650 IF ZA=0 THEN ZE=1: GOTO 10940
10660 IF VAL(ZC$)<100 THEN ZC$=ZC$+ZC$+ZC$+ZC$
10670 MID$(ZM$,ZA,LEN(ZC$))=ZC$
10680 ZB=(ZA-1)/3
10690 ZC=59
10700 ZC$=LEFT$(ZC$,3)
10710 IF VAL(ZC$)<100 THEN ZF=3 ELSE ZF=0
10720 FOR ZI=0 TO ZF
10730 LOADM"EM"+ZC$+"/"+RIGHT$(STR$(ZI),1)
10740 A=USR9(ZC*256+ZB+ZI)
10750 NEXT
10760 GOTO 10940
10770 '
10780 ' WRI(TE) FUNCTION - WRITES BLOCK TO DISK FILE
10790 GOSUB 10910
10800 ZA=INSTR(ZM$,ZC$)
10810 IF ZA=0 THEN ZE=1: GOTO 10940
10820 ZB=(ZA-1)/3
10830 ZC=59
10840 IF VAL(ZC$)<100 THEN ZF=3 ELSE ZF=0
10850 FOR ZI=0 TO ZF
10860 A=USR9((ZB+ZI)*256+ZC)
10870 SAVEM"EM"+ZC$+"/"+RIGHT$(STR$(ZI),1),&H6000,&H7FFF,&H6000
10880 NEXT
10890 GOTO 10940
10900 '
10910 ' CONVERT ZC$"SUBROUTINE
10920 ZC$=RIGHT$("000"+ZC$,3)
10930 RETURN
10940 RETURN
