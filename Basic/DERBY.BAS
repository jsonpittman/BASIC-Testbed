0 ' COPYRIGHT 1989  FALSOFT,INC
1000 'The CoCo Derby!
1010 '
1020 'By Joe Wilensky
1030 '1 Oak Ridge Place
1040 'Eastchester, N.Y. 10709
1050 'title screen
1060 CLS3
1070 PLAY"V25"
1080 PRINT@224,"WELCOME TO THE TRS-80 RACEWAY!!!";
1090 SCREEN0,1
1100 PLAY"T5CEGP15CEGP15CEG"
1110 'put horses in arrays
1120 CLS0
1130 PRINT"SETTING UP...";
1140 FORX=1TORND(RND(RND(985))):T=RND(TIMER):NEXTX
1150 'H=HORSE ARRAY, R=# OF RACES
1160 'P=# OF PLAYERS, P$(X)=NAME OF   PLAYER(X)
1170 RN=1
1180 DIMH(3,2),I(3,2)
1190 PMODE4,1:PCLS
1200 DRAW"BM129,98"
1210 DRAW"R3BR1BD1D2NG2R1U2D2R1U2D1R1D1U1ND1R4L1D1NF3R3NF2L3U2R1E1U1R3L1U1L1D1L1D1L2BL2U1R1E1G1L1D2L5"
1220 PRESET(132,99)
1230 GET(127,96)-(145,104),H,G
1240 DRAW"BM160,98;R3BR1BD1D2D1R1D1F1H1U1R2E1F1R1NU1D1G1E1U2E3R1L1U1L1D1L2H1NE1L1D1BL3D1R2BR2BNU1R2NG2G1L5D1R2"
1250 PRESET(165,98):PRESET(166,98)
1260 GET(158,96)-(176,104),I,G
1270 PCLS
1280 'questions to player(s)
1290 CLS 0
1300 PRINT"USE HIGH-SPEED POKE";:INPUTQ$:CLS0
1310 INPUT"HOW MANY RACES";R
1320 IF R<1 THEN 1310
1330 INPUT"HOW MANY PLAYERS (1-4)";P
1340 IF P<1 OR P>4 THEN1330
1350 PRINT
1360 FOR X=1 TO P:PRINT"NAME OF PLAYER"X;:INPUTP$(X):NEXTX
1370 IFP<4THEN FOR X=(P+1) TO 4:P$(X)="TRS-80":NEXTX
1380 W(1)=1000:W(2)=1000:W(3)=1000:W(4)=1000
1390 'main scoreboard and betting
1400 CLS
1410 PRINT"NAME   WALLET  HORSE  BET"
1420 PRINT"-------------------------"
1430 PRINT@64,P$(1);:PRINT@71,W(1);
1440 PRINT@96,P$(2);:PRINT@103,W(2);
1450 PRINT@128,P$(3);:PRINT@135,W(3);
1460 PRINT@160,P$(4);:PRINT@167,W(4);
1470 PRINT@192,"-------------------------"
1480 IF RN>R THEN 2400
1490 PRINT
1500 PRINT@416,"BETTING FOR RACE NO."RN;
1510 FOR X=1 TO P
1520 IFW(X)=0THEN1570
1530 PRINT@256,P$(X)", WHAT HORSE (1-4)";:INPUTHR(X)
1540 PLAY"T255O5AEC"
1550 IF HR(X)<1 OR HR(X)>4 THEN 1530
1560 PRINT@((X*32)+15)+32,HR(X);
1570 NEXTX
1580 FORT=1TO460:NEXTT
1590 IFP=>4THEN1660
1600 FORT=1TO460:NEXTT
1610 FORX=P+1TO4
1620 HR(X)=RND(4)
1630 PRINT@((X*32)+15)+32,HR(X);
1640 PLAY"T4CE"
1650 NEXTX
1660 FORX=1TOP
1670 IF W(X)=0THEN1730
1680 PRINT@256,P$(X)", WHAT'S YOUR BET";:INPUTB(X)
1690 PLAY"T255O1ACEFF+"
1700 IF B(X)>W(X)THEN1680
1710 IF B(X)<.5 THEN1680
1720 PRINT@((X*32)+21)+32,B(X);
1730 NEXTX
1740 FORT=1TO460:NEXTT
1750 IFP=>4THEN1820
1760 FORX=P+1TO4
1770 IF W(X)=0 THEN 1810
1780 B(X)=RND(151)+49
1790 PRINT@((X*32)+21)+32,B(X);
1800 PLAY"T4EC"
1810 NEXTX
1820 PRINT@416,"PRESS <ENTER> TO START RACE     NUMBER"RN".";
1830 IF INKEY$<>CHR$(13)THEN1830
1840 CLS0
1850 'the race the race the race
1860 PL=0
1870 PMODE4,1:PCLS:SCREEN1,1
1880 LINE(0,24)-(255,24),PSET
1890 LINE(0,60)-(255,60),PSET
1900 LINE(0,96)-(255,96),PSET
1910 LINE(0,132)-(255,132),PSET
1920 LINE(0,168)-(255,168),PSET
1930 LINE(248,24)-(248,168),PSET
1940 LINE(249,24)-(249,168),PSET
1950 FORX=1TO4:X(X)=2:NEXTX
1960 Y(1)=38:Y(2)=74:Y(3)=110:Y(4)=146
1970 IF RN=1 THEN V=2 ELSE V=1
1980 GOSUB2530
1990 FORX=1TO4
2000 PUT(X(X),Y(X))-(X(X)+18,Y(X)+8),H,PSET
2010 PLAY"T4O1B"
2020 NEXTX
2030 FOR T=1 TO 920:NEXT T
2040 'start running
2050 IF Q$="Y" OR Q$="YES" THEN POKE65495,0
2060 PLAY"T255O1CFAO2CFAO3CFAO4CFAO5CFA"
2070 X=RND(4)
2080 IF X(X)=0THEN2070
2090 X(X)=X(X)+1
2100 IF(X(X))/2=INT(X(X)/2)THEN2130
2110 PUT(X(X),Y(X))-(X(X)+18,Y(X)+8),I,PSET
2120 GOTO2140
2130 PUT(X(X),Y(X))-(X(X)+18,Y(X)+8),H,PSET
2140 IF(X(X)+18)>=248THENGOSUB2160
2150 GOTO2070
2160 PLAY"T2O2CGF":'winnings
2170 X(X)=0
2180 FORT=1TO500:NEXTT
2190 PL=PL+1
2200 IFPL>1THEN2260
2210 '
2220 WN=X
2230 F=X
2240 GOSUB2340
2250 GOTO2270
2260 F=X
2270 S$=STR$(Y(F)):T$="BM200,"+S$
2280 IFPL=1THENDRAW"XT$;D8"
2290 IFPL=2THENDRAW"XT$;R5D4L5D4R5"
2300 IFPL=3THENDRAW"XT$;R5D4NL5D4L5"
2310 IFPL=4THENDRAW"XT$;D4R5U4D8"
2320 IF PL=4THENRN=RN+1:GOSUB2490:POKE65494,0:GOTO1400
2330 SCREEN1,1:RETURN
2340 'wallet reducing
2350 FOR X=1TO4
2360 IFHR(X)=WN THEN W(X)=W(X)+B(X):ELSEW(X)=W(X)-B(X)
2370 IFW(X)<=0THENB(X)=0:HR(X)=0
2380 NEXTX
2390 RETURN
2400 'end of game
2410 IFW(1)>W(2)ANDW(1)>W(3)ANDW(1)>W(4)THENWN=1
2420 IFW(2)>W(1)ANDW(2)>W(3)ANDW(2)>W(4)THENWN=2
2430 IFW(3)>W(1)ANDW(3)>W(2)ANDW(3)>W(4)THENWN=3
2440 IFW(4)>W(1)ANDW(4)>W(2)ANDW(4)>W(3)THENWN=4
2450 IF WN=0THENPRINT@256,"THERE IS NO WINNER!"ELSEPRINT@256,"THE WINNER IS "P$(WN)",":PRINT@288,"PLAYER NUMBER"WN"!"
2460 PRINT@352,"THANK YOU FOR PLAYING NEW       D E R B Y  2 !"
2470 PLAY"T2O3CCF"
2480 END
2490 FORT=1TO600:NEXTT:PLAY"O3T4FP4T8CCP6T6DCP4T4EF"
2500 IFINKEY$=""THEN2500
2510 RETURN
2520 'call to the post
2530 PLAY"T4P1":FORT=1TOV:PLAY"V31T4O3L8CFAO4CL8CCCCL8CO3AL8AAAAL8AFAFL1CL8CFAO4CL8CCCCL8CO3CL8CCCCL8CL1FP8":NEXTT
2540 PLAY"L4V25"
2550 RETURN
