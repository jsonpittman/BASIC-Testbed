0 ' COPYRIGHT 1990 FALSOFT, INC
100 ' DIGITAL LOGIC ANALYZER
110 ' BASIC PROGRAM
120 ' WRITTEN BY DENNIS H. WEIDE
130 '
140 CLEAR150,&H3B00:POKE150,1:POKE&HFF43,145:'PROGRAM 8255
150 CLS:PRINT" DIGITAL LOGIC ANALYZER PROGRAM"
160 PRINTTAB(7)"BY DENNIS H. WEIDE"
170 DIM GR(20),BL(5),B1(13)
180 DATA 4F,8E,3D,0,A7,80,8C,7C,FF,2F,F9,39
190 DATA 8E,3D,0,4F,B7,FF,41,B6,FF,40,A7,80,86,4,B7,FF,41,4F,B7,FF,41,B6,FF,40,A7,80,8C,7C,FF,2F,ED,39
200 DATA BE,3B,AE,10,8E,3C,0,B6,3B,AD,A4,80,A7,A0,10,8C,3C,EF,2F,F3,39
210 FORX=&H3BB0 TO &H3BBB
220 READA$:A$="&H"+A$
230 POKEX,VAL(A$):NEXTX
240 FORX=&H3BC0 TO &H3BDF
250 READA$:A$="&H"+A$
260 POKEX,VAL(A$):NEXTX
270 FORX=&H3BE6 TO &H3BFA
280 READA$:A$="&H"+A$
290 POKEX,VAL(A$):NEXTX
300 FORX=0TO9:READN$(X):NEXT
310 DATA U8R5D8NL5BR3,R2LU8NGBR4BD8,NR5UE5U2L5NDR5BR3BD8,NUR5U4NL4U4L5DUBR8BD8,BU4NU4R5U4D8BR3
320 DATA UDR5U5L5U3R5BR3BD8,R5U4L5D4U8R5DBR3BD7,UE5U2L5NDBR8BD8,NR5U4NR5U4R5D8BR3,NUR5U8L5D4R5BR3BD4
330 EXEC&H3BB0:POKE&HFF41,2:'ZEROBUF & CLR FF
340 PRINT:PRINTTAB(7)"ENTER CLOCK SPEED":PRINT
350 PRINTTAB(10)"0. DIV BY 1":PRINTTAB(10)"1. DIV BY 2":PRINTTAB(10)"2. DIV BY 4":PRINTTAB(10)"3. DIV BY 8":PRINTTAB(10)"4. DIV BY 16"
360 PRINTTAB(10)"";:INPUT"SPEED >";S
370 S$="&H"+HEX$(S)+"0":S=VAL(S$):POKE&HFF42,S+128
380 PRINT:PRINTTAB(7)"SET SWITCH TO OCLK"
390 PRINTTAB(5)"";:LINEINPUT"PRESS <ENTER> TO BEGIN";B$
400 POKE&HFF41,9:'ENABLE FF & SRAM WRITE
410 I$(1)="BM104,190;NR5U8R5D8BR3R2LU8G"
420 I$(2)="BM104,190;R2LU8NGBR4R5D8L5U8"
430 '
440 ' CALCULATE START OF TRACE
450 '
460 FORX=0TO7
470 P$(X)="BM15,"+STR$(22*X+20)+";"
480 NEXTX
490 '
500 ' WAIT FOR HALT & ENTER INFO
510 '
520 IFPEEK(&HFF42)AND1THEN530ELSE520:'CHECK FOR HALT
530 POKE&HFF42,S:CLS:PRINT:PRINTTAB(6)"SYSTEM HALT DETECTED":PRINT:PRINT
540 POKE&HFF41,2:FORX=1TO1000:NEXT:'CLR SRAM WRITE & FF
550 PRINTTAB(7)"SET SWITCH TO CCLK"
560 PRINTTAB(9)"PRESS <ENTER>";
570 LINEINPUTB$:EXEC&H3BC0:'MOVE SRAM TO DRAM
580 PRINT:PRINTTAB(6)"";:LINEINPUT"ENTER TIME SLOT>";TS$:TS=VAL(TS$)
590 IFTS<0ORTS>16144THENTS=16144
600 PMODE4,1:PCLS5:COLOR0:POKE65495,0
610 GET(10,10)-(23,20),BL,G
620 GET(143,181)-(182,191),B1,G
630 '
640 ' DRAW A-H INPUT DESIGNATIONS
650 '
660 DRAW"BM0,18;U4E2F2D4U2L4"
670 DRAW"BM0,40;U6R3D3NL3RD3L4"
680 DRAW"BM0,62;R4NUL4U6R4D"
690 DRAW"BM0,84;U6R3FD4GL3"
700 DRAW"BM0,106;NR4U3NR3U3R4"
710 DRAW"BM0,128;U3NR3U3R4"
720 DRAW"BM0,150;R4U2NLD2L4U6R4D"
730 DRAW"BM0,172;U6BR4D3NL4D3"
740 DRAW"BM20,190;NUR5U4L5U4R5DBD2BR3R3BD2L3"
750 DRAW"BM90,190;R4L2U8NL2R2BR3BD3R3BD2L3"
760 DRAW"BM200,190;NR5U4NR4U4R5BR3BD3R3BD2L3"
770 DRAW"BM130,190;R5UDL5U8R5DBR3BD2R3BD2L3"
780 DRAW"BM144,190;":T=0:GOSUB1390
790 DRAW"BM34,190;":T=TS:GOSUB1390
800 DRAW"BM215,190;":T=TS+239:GOSUB1390
810 I=1:DRAW"XI$(1);"
820 '
830 ' DRAW LOGIC LEVEL INDICATORS
840 '
850 A$="R2LU5G"
860 B$="U5R3D5L3"
870 FORX=0TO7
880 C$="BM10,"+STR$(22*X+12)+";"+A$
890 D$="BM9,"+STR$(22*X+22)+";"+B$
900 DRAW"XC$;":DRAW"XD$;"
910 NEXT
920 '
930 ' CALCULATE TIME SLOT OFFSET
940 '
950 TS=TS+15616:T1=INT(TS/256):T2=(TS/256)-INT(TS/256):T2=T2*256
960 '
970 ' LOAD MEMORY WITH ML PARAMETERS
980 '
990 POKE&H3BAE,T1:POKE&H3BAF,T2:'PASS TIMESLOT
1000 FORY=0TO7
1010 POKE&H3BAD,2^Y:'PASS POWER OF 2
1020 EXEC&H3BE6:'FIND BIT SET
1030 SCREEN1,1
1040 IFPEEK(&H3C00)>0THENLA=1ELSELA=0
1050 DRAW"XP$(Y);"
1060 '
1070 ' READ BUFFER AND DRAW TRACE
1080 '
1090 IFLA=1THENDRAW"BU10"
1100 FORX=&H3C00 TO&H3CEF
1110 A=PEEK(X)
1120 IFA>0THENA=1
1130 IFA=1ANDLA=1THENDRAW"R"
1140 IFA=1ANDLA=0THENDRAW"U10R"
1150 IFA=0ANDLA=0THENDRAW"R"
1160 IFA=0ANDLA=1THENDRAW"D10R"
1170 LA=A
1180 NEXTX,Y:POKE65494,0
1190 '
1200 ' COMMAND INPUT SECTION
1210 '
1220 I$=INKEY$
1230 IFI$=""THEN1220
1240 IFI$="C"THEN1500
1250 IFI$=CHR$(8)THEN1590
1260 IFI$=CHR$(9)THEN1680
1270 IFI$="A"THENCLS:GOTO330
1280 IFI$="T"THENPRINT:GOTO580
1290 IFI$="E"THEN1820
1300 IFI$="X"THENSTOP
1310 IFI$="I"THEN1320ELSE1220
1320 IF I=1 THEN I=10 ELSE I=1
1330 PUT(103,180)-(116,190),BL,OR
1340 IF I=1 THEN DRAW"XI$(1);" ELSE DRAW"XI$(2);"
1350 GOTO1220
1360 '
1370 ' PRINT TIMESLOTS
1380 '
1390 M$=STR$(T):M=LEN(M$)-1
1400 M$=RIGHT$(M$,M)
1410 M$="0000"+M$
1420 M$=RIGHT$(M$,5)
1430 FORR=1TO5
1440 V=VAL(MID$(M$,R,1))
1450 DRAW"XN$(V);"
1460 NEXTR:RETURN
1470 '
1480 ' DISPLAY CURSOR ON C COMMAND
1490 '
1500 G1=127:G2=129:L1=128
1510 GET(G1,0)-(G2,180),GR,G
1520 LINE(L1,0)-(L1,180),PSET
1530 PUT(143,181)-(182,191),B1,OR
1540 GOSUB1770:GOTO1220
1550 GOTO1220
1560 '
1570 ' MOVE CURSOR LEFT
1580 '
1590 PUT(G1,0)-(G2,180),GR,OR
1600 G1=G1-I:G2=G2-I:L1=L1-I
1610 IF G1<14 THEN G1=14:G2=16:L1=15
1620 GET(G1,0)-(G2,180),GR,G
1630 LINE(L1,0)-(L1,180),PSET
1640 GOSUB1770:GOTO1220
1650 '
1660 ' MOVE CURSOR RIGHT
1670 '
1680 PUT(G1,0)-(G2,180),GR,OR
1690 G1=G1+I:G2=G2+I:L1=L1+I
1700 IF G1>253 THEN G1=253:G2=255:L1=254
1710 GET(G1,0)-(G2,180),GR,G
1720 LINE(L1,0)-(L1,180),PSET
1730 GOSUB1770:GOTO1220
1740 '
1750 ' UPDATE CURSOR LOCATION
1760 '
1770 PUT(143,181)-(182,191),B1,OR
1780 T=TS+G1-15616-14:DRAW"BM144,190;":GOSUB 1390:RETURN
1790 '
1800 ' ERASE CURSOR
1810 '
1820 PUT(G1,0)-(G2,180),GR,OR
1830 T=0:G1=127:G2=129:L1=128:PUT(143,181)-(182,191),B1,OR:DRAW"BM144,190;":GOSUB1390:GOTO1220
1840 POKE65497,0:FORX=&H3D00 TO &H7CFF
1850 POKEX,PEEK(&HFF40)
1860 POKE&HFF41,4:POKE&HFF41,0
1870 NEXT:POKE65496,0:RETURN
1880 POKE&HFF41,0:FORX=&H3D00 TO &H7CFF
1890 PRINTPEEK(X),PEEK(&HFF40)
1900 POKE&HFF41,4:POKE&HFF41,0
1910 NEXT
