1 'MASTER LIST
2 'WRITTEN BY PETER MASTERSON
3 'COPYRIGHT (C) FEBRUARY 1992  ** BY FALSOFT, INC.             ** RAINBOW MAGAZINE
4 FILES 2,402
5 ST$=CHR$(202)+STRING$(30,32)+CHR$(197):BE$="L100O4C":TM=20:MN=1:CL=76:TA$=STRING$(10,32)
6 DIM MO$(12),A$(100),A(100)
7 FOR X=1TO8:READ S$(X):NEXT:     FOR X=1TO8:READ F$(X):NEXT
10 DEFUSR0=30017:DEFUSR1=30113:    DEFUSR2=30091:DEFUSR3=30132:    DEFUSR4=30000:DEFUSR5=30057
12 M$(1,1)="ADD DEL EDIT FIND PRINT REC SOR":M$(1,2)="aDD dEL eDIT fIND pRINT rEC sOR":M$(2,1)="NAME XFER MARK DISK RESTORE QUI":K$(1)="ADEFPRS ":M$(2,2)="nAME xFER mARK dISK rESTORE qUI":K$(2)="NXMDRQ "
20 EXEC 30211
22 IF PEEK(450)=0 THEN GOSUB1300:POKE 450,1
30 S=1446:E=1471:A$="":MX=25:PRINT@422,"";:GOSUB6000:IF BK=1THENPRINT@423,STRING$(14,32);:PLAY BE$:GOTO30
32 IF LEN(A$)=0THEN B$="MLIST/DAT":A$="MLIST   /DAT":GOTO37
34 B$=A$:A=INSTR(A$,"/"):IF A=0THEN A=INSTR(A$,"."):IF A=0THEN G=8-LEN(A$):A$=A$+STRING$(G,32)+"/DAT":GOTO37
36 I=8-A:C$=MID$(A$,1,A-1)+STRING$(I,32)+"/"+MID$(A$,A+1,3):A$=C$
37 FO$=A$
38 IF B$=FI$ THEN68 ELSE FF$=B$
40 IF RT=1 THEN RETURN
50 CLOSE:PRINT@422,B$;:EXEC 30165:PRINT@422,B$;:OPEN"D",#1,B$,201:FIELD#1,201 AS R$:SO$=MID$(FO$,1,8)+"/TMP":FI$=B$
52 LO=LOF(1)-1:IF LO<=0 THEN RC=0:LO=0:LSET R$="1":PUT#1,1 ELSE RC=1:B=1
53 PRINT@64,STRING$(30,32)
54 DSKI$ 0,17,1,A$,B$:DT$=MID$(A$,1,8):IF MID$(DT$,1,1)=CHR$(255)THEN DT$="MM/DD/YY"
55 M=VAL(MID$(DT$,1,2)):I=VAL(MID$(DT$,4,2)):I$=STR$(I):DA$=RIGHT$(I$,LEN(I$)-1):F9$=MO$(M)+" "+DA$+", 19"+MID$(DT$,7,2)
56 GET#1,1:SF$=MID$(R$,1,1):SF=VAL(SF$):DL$=MID$(R$,2,3):DL=VAL(DL$)
57 IF DL=LOF(1)-1 THEN RC=0:LO= LOF(1)-1:GOSUB5030 ELSE GOSUB5000
58 GET#1,RC+1
60 PRINT@0,"SORTED BY "S$(SF):PRINT@24,DT$:GOTO70
68 RT=0:PRINT@417,STRING$(30,32);:PRINT@417,"FILE"CHR$(202);FI$;:BK=0:RT=0:SET(10,28,5)
70 FOR X=1TO TM:PRINT@480,M$(MN,1);:GOSUB80:NEXT:FOR X=1TO TM:PRINT@480,M$(MN,2);:GOSUB80:NEXT: GOTO70
72 GOTO68
80 POKE344,255:IF PEEK(344)=247 THEN RC=RC+1:B=1:GOSUB5000
82 POKE343,255:IF PEEK(343)=247 THEN RC=RC-1:B=-1:GOSUB5000
84 Z$=INKEY$:IF Z$=""THEN RETURN
86 IF RT=1 THEN RETURN
90 I=INSTR(K$(MN),Z$):IF I=0THENRETURN
92 PRINT@480,M$(MN,1);
94 RR=RC:ON MN GOTO95,97
95 ON I GOSUB100,200,300,400,500,800,900,950
96 GOTO98
97 ON I GOSUB1000,1100,1200,1500,1400,1900,950
98 IF MC=0THEN68ELSE MC=0:GOTO70
100 PRINT@480,"add";
101 IF LOF(1)>101 THEN GOSUB5040:PRINT@417,"100 RECORDS MAX - PRESS [ENTER]";:EXEC44539:RETURN
102 RR=RC:GOSUB5040:PRINT@423,"USE [BREAK] TO ABORT";:LO=LO+1:RC=LO
105 GOSUB5030
110 S=1158:E=1406:MX=25:EXEC30165:GOSUB6000:IF BK=0THEN120ELSE RC=RR:LO=LO-1:IF LO=0 THEN EXEC30165
115 GOSUB5000:RETURN
120 A$=STRING$(200,32):X=USR3(VARPTR(A$)):IF RT=1 THEN LO=LOF(1)-1:RETURN ELSE LSET R$=A$:PUT#1,LOF(1)+1:GOSUB5030:RETURN
200 PRINT@484,"del";:GOSUB5040:PRINT@425,"SELECTIVE (Y/N)";:K$="YN ":GOSUB5050
205 ON I GOSUB230,220,68
210 RETURN
220 E$=R$:MID$(E$,201,1)="D":LSET R$=E$:PUT#1,RC+1:RC=RC+1:DL=DL+1:GOSUB250:GOSUB5000:LSET R$=SF$+RM$+DL$:PUT#1,1
225 RETURN
230 FOR E=2 TO LO+1:GET#1,E:IF MID$(R$,201,1)="M"THEN RC=E-2:E$=R$:MID$(E$,201,1)="D":LSET R$=E$:PUT#1,E:DL=DL+1
235 NEXT
240 GOSUB250:LSET R$=SF$+DL$:PUT#1,1
245 RETURN
250 A$=STR$(DL):DL$=MID$(A$,2,LEN(A$)):IF DL=LOF(1)-1 THEN RC=0:GOSUB5030:EXEC30165
252 RETURN
300 PRINT@488,"edit";:POKE459,0:W$=STRING$(200,32):X=USR3(VARPTR(W$)):EXEC30466:IF PEEK(459)=1THEN X=USR5(VARPTR(W$)):RETURN ELSE X=USR3(VARPTR(W$)):LSET R$=W$:PUT#1,RC+1:RETURN
400 PRINT@493,"find";
405 GOSUB5040:PRINT@422,"SELECT FIELD TO FIND";
407 GOSUB5060:IF BK=1THEN RETURN
410 SET(10,28,5)
415 GOSUB5040:PRINT@417,F$(LI)CHR$(202);:SET(10,28,5):MX=25:S=1446:E=S+MX-1:GOSUB6000:IF BK=1  OR RT=1THEN RETURN
416 IF RT=1 THEN RETURN
420 IF RC=LO THEN NF=1:RETURN   ELSE FOR X=RC+2 TO LO+1:GET#1,X
422 I$=MID$(R$,25*LI-24,25):IF INSTR(I$,A$)<>0 AND MID$(R$,201,1)<>"D" THEN RC=X-1:GOSUB5025:RETURN
424 NEXT
426 GOSUB5040:IF RT=1 THEN NF=1:RETURN ELSE PRINT@420,"NOT FOUND - PRESS [ENTER]";:EXEC44539:GOTO415
500 SS=SF:RT=1:PRINT@498,"print";:GOSUB5040
510 PRINT@417,"L]ABELS S]END LISTS([1][2][3])";:K$="LS123 ":GOSUB5050:IF I=6 THEN SF=SS:GOTO98 ELSE TY=I
512 IF TY=2 THEN630
520 GOSUB5040:PRINT@417,"F]ILE M]ARKERS R]ECORD S]EARCH";:K$="FMRS ":GOSUB5050:IF I=5THEN510ELSE WH=I
522 IF TY>2 AND WH<>3 THEN PRINT#-2,FI$;STRING$(20,32);"SORTED BY "S$(SF)STRING$(20,32);DT$:PRINT#-2,CHR$(10)
526 GOSUB5040:PRINT@426,"PRINTING...";
530 ON WH GOSUB 550,560,540,570
532 GOTO 510
540 FOR L=1 TO 8:P=L*25-24:I$=MID$(R$,P,25):X=USR0(VARPTR(I$)): L$(L)=MID$(I$,1,X):NEXT:N1$=L$(2)+" "+L$(1):N2$=L$(1)+" "+L$(2)
542 ON TY GOSUB 580,,640,650,660
545 RETURN
550 FOR O=2 TO LOF(1):GET#1,O:  RC=O-1:GOSUB5000:GOSUB540
552 NEXT:GOTO510
560 FOR O=2 TO LOF(1):GET#1,O:  IF MID$(R$,201,1)="M"THEN RC=O-1:GOSUB5000:GOSUB 540
562 NEXT:GOTO510
570 GOSUB405
572 AA$=A$:PO=LI*25-24:FOR O=1 TO LOF(1):GET#1,O:GI$=MID$(R$,PO,25):I=INSTR(GI$,AA$):IF I<>0 THEN RC=O-1:GOSUB5000:GOSUB540
574 NEXT O:GOTO510
580 IF LEN(L$(3))<>0 THEN PRINT#-2,L$(3):PRINT#-2,"c/o "N1$:GOTO584
582 PRINT#-2,N1$
584 FOR R=4TO7:PRINT#-2,L$(R):NEXT:PRINT#-2:RETURN
630 GOSUB5040:PRINT@417,"PRINTER CODES:"; :S=PEEK(136)*256+PEEK(137):E=S+25:M=25:GOSUB6000:IF BK=1 THEN510 ELSE A=VAL(A$):PRINT#-2,CHR$(A);
632 GOTO 630
639 'list one
640 IF SF=1 THEN A$(1)=N2$:A$(2)=L$(8) ELSE IF SF=8 THEN A$(1)=L$(8):A$(2)=N1$ ELSE A$(1)=N1$:A$(2)=L$(8):SF=2
642 GOSUB670:I=50-LEN(A$(1)):PRINT#-2,A$(1);STRING$(I,46);A$(2)
644 NP=NP+1:RETURN
649 'list two
650 P=2:IF SF<4 OR SF>6 THEN A$(1)=L$(4):SF=4 ELSE A$(1)=L$(SF)
652 IF SF=4 THEN A$(2)=L$(5):A$(3)=L$(6):GOTO656
653 IF SF=5 THEN A$(2)=L$(6):A$(3)=L$(4):GOTO656
654 IF SF=6 THEN A$(2)=L$(4):A$(3)=L$(5)
656 GOSUB670:FOR Z=1 TO 2:I=25-LEN(A$(Z)):PRINT#-2,A$(Z);STRING$(I,46);:NEXT:PRINT#-2,A$(3):NP=NP+1:RETURN
659 'list three
660 SF=2:GOSUB640:GOSUB650:SF=SS:PRINT#-2," ":RETURN
670 IF TY=5 THEN RETURN
672 IF MID$(A$(1),1,1)<>O$ THEN PRINT#-2," ":NP=NP+1:O$=MID$(A$(1),1,1)
674 RETURN
800 PRINT@504,"rec";:LL=LO
810 GOSUB5040:PRINT@417,"RECORD NUMBER 1 TO"LL">";:S=PEEK(136)*256+PEEK(137):E=S+3:MX=3:GOSUB6000:IF BK=1THEN RETURN ELSE A=VAL(A$):IF A<1 OR A>LL THEN810
815 IF RT=1THEN RETURN
820 RC=A:GOSUB5000:GOTO68
900 BK=0:TR=0:PRINT@508,"sor";:POKE1535,20:GOSUB5040:P=0:PRINT@422,"SELECT FIELD TO SORT";:GOSUB5060:IF BK=1  THEN RETURN
902 LL=LOF(1)
905 CLOSE#2:OPEN"D",#2,SO$,201: FIELD#2,201 AS SG$
910 GOSUB5040:PRINT@428,"READING...";
911 A$(1)="":X=2
912 GET#1,X:IF MID$(R$,201,1)="D"THEN A$(X)=CHR$(255) ELSE A$(X)=MID$(R$,25*LI-24,25)
913 IF X<LL THEN X=X+1:GOTO912
914 PRINT@428,"SORT";
920 X=1
922 X=X+1
924 IF X>LL THEN 940
926 IF A$(X)=CHR$(255)THEN922
928 FOR Y=1 TO LL
930 IF A$(Y)<A$(X) THEN X=Y
932 NEXT
934 P=P+1:A(P)=X:A$(X)=CHR$(255):GOTO920
940 PRINT@428,"WRIT";
942 FOR Z=2 TO LL:B=A(Z): IF B=0 THEN 944 ELSE IF B=-1 THEN 94  ELSE GET#1,B:LSET SG$=R$:PUT#2,Z:
944 NEXT
946 A$=STR$(SF):B$=MID$(A$,2,1):LSET R$=B$:PUT#2,1:A$=STR$(LI): B$=MID$(A$,2,LEN(A$)):LSET SG$=B$+RM$:PUT#2,1:CLOSE:KILL FO$:RENAME SO$ TO FO$:A$=FI$:SF$=B$
948 GOSUB5040:SET(10,28,5):PRINT@417,"FILE"CHR$(202);FI$;:PRINT@508,"SOR";:POKE1535,84:B$=FI$:  GOTO50
950 MC=1:MN=MN+1:IF MN=3THEN MN=1
952 DL=0:DL$=" ":RETURN
1000 PRINT@422,STRING$(25,32);: PRINT@480,"name";:GOSUB30:RETURN
1100 PRINT@485,"xfer";:GOSUB5040
1110 PRINT@421,"[T]RANSFER OR [A]PPEND";:K$="TA ":GOSUB5050:IF I=3 THEN RETURN ELSE CO=I
1112 GOSUB5040:PRINT@425,"SELECTIVE (Y/N)";:K$="YN ":GOSUB5050: IF I=3THEN1110 ELSE SL=ABS(I-2)
1114 SC=1:GOSUB5090
1116 Y=1:ON CO GOTO 1120,1150
1118 RETURN
1120 IF SL=1THEN B=1 ELSE B=RC
1122 FOR T=B TO LOF(1)-1:RC=T:GOSUB 5000:IF SL=0THEN1124 ELSE IF MID$(R$,201,1)<>"M"THEN1128
1124 IF MID$(R$,201,1)="D"THEN1128
1126 Y=Y+1:LSET H$=R$:PUT#2,Y
1128 NEXT:F$=SF$:LSET H$=F$:PUT#2,1:RETURN
1150 FOR T=2 TO LOF(2):GET#2,T:IF SL=0 THEN 1152 ELSE IF MID$(H$,201,1)<>"M"THEN1156
1152 IF MID$(H$,201,1)="D"THEN1156
1154 LSET R$=H$:PUT#1,LOF(1)+1: LO=LO+1:RC=LO:GOSUB5000
1156 NEXT:LSET R$=SF$:PUT#1,1
1158 RC=1:LO=LOF(1)-1:GOSUB5000:RETURN
1200 NF=0:RT=1:PRINT@490,"mark";:GOSUB5040
1210 PRINT@417,"TRAVEL FIND MARK UNMARK REMOVE";
1212 K$="TFMUR ":GOSUB5050:IF I=6 THEN 98
1214 ON I GOSUB 1220,1240,1250, 1260,1270
1216 GOTO1210
1220 RT=1:GOSUB5040:PRINT@417,"M]ARK U]NMARK  D]EL [SPC]ABORT";
1222 GOSUB80
1224 I=INSTR("MUD ",Z$):IF I=0  THEN1222
1226 IF Z$="D" THEN GOSUB220:GOTO1222
1228 IF Z$=" " THEN 1200
1230 IF Z$="M"  THEN GOSUB1250
1232 IF Z$="U" THEN GOSUB1260
1234 GOTO1222
1240 GOSUB407
1242 GOSUB420:IF NF=1 THEN1244  ELSE IF BK=1 THEN 98 ELSE E$=R$:IF MID$(R$,201,1)="M" THEN 1242 ELSE MID$(E$,201,1)="M":LSET R$=E$:PUT#1,RC+1:EXEC30040:IF RC>=LO THEN 1244 ELSE 1242
1244 RETURN
1250 IF MID$(R$,201,1)="M"THEN  RETURN ELSE E$=R$:MID$(E$,201,1)="M":LSET R$=E$:PUT#1,RC+1:GOSUB5000:RETURN
1260 IF MID$(R$,201,1)=" "THEN  RETURN ELSE LSET R$=LEFT$(R$,200):PUT#1,RC+1:EXEC30040:RETURN
1270 GOSUB5040:PRINT@429,"REMOVE";
1272 FOR U=RC+1 TO LOF(1):GET#1,U: IF MID$(R$,201,1)="M" THEN LSET R$=LEFT$(R$,200):PUT#1,U:RC=U-1:GOSUB5000
1274 NEXT
1276 RETURN
1300 PRINT@232,"TODAY'S DATE PLEASE";
1310 PRINT@417,"DATE";:S=1446:MX=25:PRINT@422,STRING$(25,32);:PRINT@422,"";:GOSUB6000
1312 PRINT@232,STRING$(20,32);: PRINT@422,STRING$(24,32);:PRINT@417,"FILE";
1320 DSKO$ 0,17,1,A$,STRING$(128,255):PRINT@24,A$;:DT$=A$:RETURN
1399 GOTO4999
1400 PRINT@500,"restore";
1410 FOR U=2 TO LOF(1):GET#1,U
1412 IF MID$(R$,201,1)="D"THEN  LSET R$=LEFT$(R$,200):PUT#1,U:  RC=U-1:GOSUB5000
1414 NEXT
1420 DL=0:DL$=" ":LSET R$=SF$+RM$:PUT#1,1:RETURN
1500 POKE30197,33:POKE30198,72: EXEC30192:PRINT@495,"disk";
1510 GOSUB5040:PRINT@417,"DRIVE NUMBER:";:S=PEEK(136)*256+PEEK(137):MX=17:GOSUB6000:IF BK=1 THEN RETURN
1520 A=VAL(A$):CLS:PRINT@5,"- DRIVE"A"DIRECTORY -":PRINT:OD=PEEK(&H95A):DRIVE A:EXEC32000:PRINT:PRINTCHR$(8)FREE(A)"FREE GRANS."
1522 PRINT@489,"PRESS [ENTER]";:EXEC44539:DRIVE OD:POKE30216,33:POKE30217,72:EXEC30211
1524 POKE 30216,31:POKE30217,64:     POKE 30197,31:POKE30198,64
1526 RETURN
1800 EXEC44539:END
1900 CLS:PRINT@237,"QUIT":END
4999 EXEC44539:CLS:LIST
5000 IF LO=0THEN5030
5010 IF RC<1 THEN RC=LO:GOTO5020
5012 IF RC>LO THEN RC=1
5020 GET#1,RC+1:I$=MID$(R$,201,1):IF I$="D"THEN DE=1:RC=RC+B:GOTO5000
5025 DE=0:X=USR5(VARPTR(R$))
5030 PRINT@71,"RECORD ";:PRINTUSING"###";RC;:PRINT" OF ";:PRINTUSING"###";LO:IF MID$(R$,201,1)="M"THEN EXEC30040
5035 RETURN
5040 PRINT@417,STRING$(30,32);:RESET(10,28):RETURN
5050 Z$=INKEY$:IF Z$=""THEN5050
5052 I=INSTR(K$,Z$):IF I=0THEN5050
5054 RETURN
5060 X=1153:LI=1
5062 Z=USR4(X):Y=X
5063 FOR W=1TO15:NEXT
5064 Z$=INKEY$:IF Z$=" "THEN BK=1:Z=USR4(X):RETURN
5065 IF Z$=CHR$(13)THEN Z=USR4(X):RETURN
5066 IF PEEK(341)=247 THEN X=X-32:LI=LI-1:GOTO5072
5068 IF PEEK(342)=247 THEN X=X+32:LI=LI+1:GOTO5072
5070 GOTO5064
5072 IF LI<1 THEN LI=8:X=1377
5074 IF LI>8 THEN LI=1:X=1153
5080 Z=USR4(Y):GOTO5062
5090 GOSUB5040:SET(10,28,5):PRINT@417,"FILE"CHR$(202);:RT=1:GOSUB30:CLOSE#2:OPEN"D",#2,A$,201:FIELD#2,201 AS H$:IF SC=1 THEN RETURN ELSE IF LOF(2)=0THEN CLOSE:KILL A$:OPEN"D",#1,FI$,201:FIELD#1,201 AS R$:GOTO5090 ELSE FF$=A$:RETURN
6000 BK=0:A=S:GOSUB6020:POKE470,M:POKE471,L:A=E:GOSUB6020:POKE480,M:POKE481,L:POKE472,MX
6010 EXEC30230:LE=PEEK(474):IF PEEK(469)=1 THEN POKE S+LE,96:BK=1:RETURN ELSE A$=STRING$(LE,32): X=USR2(VARPTR(A$)):RETURN
6020 M=INT(A/256):L=A-(256*M):  RETURN
7010 DATA LAST NAME,FIRST NAME,CORPERATION,ADDRESS,CITY/TOWN,PROVINCE,MISC INFO,PHONE#
7012 DATA NAME,NAME,CORP,ADRS,CITY,PROV,MISC,TEL#
